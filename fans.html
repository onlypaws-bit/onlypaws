<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>OnlyPaws ‚Äî For Fans</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --bg1:#6B4EFF;
      --bg2:#8B6CFF;
      --text:#ffffff;
      --muted:rgba(255,255,255,.85);
      --stroke:rgba(255,255,255,.16);
      --card:rgba(0,0,0,.16);
      --btn:#ffffff;
      --btnText:#6B4EFF;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.18), transparent 55%),
        radial-gradient(1000px 650px at 90% 30%, rgba(0,0,0,.22), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .wrap{max-width:1040px;margin:0 auto;padding:28px 18px 70px;}

    .nav{
      display:flex;align-items:center;justify-content:space-between;gap:14px;
      margin-bottom:28px;
    }
    .brand{
      display:flex;align-items:center;gap:12px;
      text-decoration:none;color:white;font-weight:900;
      letter-spacing:.2px;
      user-select:none;
    }
    .brandLogo{
      width:62px;height:62px;border-radius:14px;
      background: rgba(255,255,255,.16);
      border:1px solid rgba(255,255,255,.18);
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
    }
    .brandLogo img{width:46px;height:46px;object-fit:contain;}
    .brandText{font-size:1.1rem;}
    .pill{
      padding:8px 14px;border-radius:999px;
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      font-size:13px;color:rgba(255,255,255,.85);
      white-space:nowrap;
    }

    .hero{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
      align-items:stretch;
    }
    @media (max-width: 920px){ .hero{grid-template-columns:1fr;} }

    .panel{
      border-radius:22px;padding:26px;
      background: var(--card);
      border:1px solid var(--stroke);
      backdrop-filter: blur(10px);
      box-shadow:0 20px 45px rgba(0,0,0,.25);
    }
    h1{
      margin:10px 0 10px;
      font-size: clamp(2.1rem, 4vw, 2.8rem);
      line-height:1.05;
      letter-spacing:-0.6px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:1.08rem;
      line-height:1.55;
      max-width:60ch;
    }

    .list{
      margin-top:16px;
      display:grid;
      gap:10px;
      color:rgba(255,255,255,.86);
      font-size:14px;
      line-height:1.5;
    }
    .listItem{
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      border-radius:16px;
      padding:12px 14px;
    }

    .btnRow{display:flex;flex-wrap:wrap;gap:10px;margin-top:18px;align-items:center;}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:12px 16px;border-radius:999px;
      background: var(--btn); color: var(--btnText);
      text-decoration:none; font-weight:900;
      box-shadow:0 14px 30px rgba(0,0,0,.22);
      transition: transform .18s ease, opacity .18s ease;
      border:none;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px) scale(1.02)}
    .ghost{
      display:inline-flex;align-items:center;justify-content:center;
      padding:12px 16px;border-radius:999px;
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      color: white;
      text-decoration:none; font-weight:800;
      cursor:pointer;
      white-space:nowrap;
    }

    .authBox{
      margin-top:18px;
      padding:16px;
      border-radius:18px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.16);
    }
    .authBox input{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.12);
      color:white;
      outline:none;
      margin-top:10px;
    }
    .authMsg{
      margin-top:10px;
      font-size:13px;
      color:rgba(255,255,255,.85);
      min-height:18px;
      white-space:pre-wrap;
    }

    .note{
      margin-top:16px;
      color: rgba(255,255,255,.78);
      font-size:13px;
      line-height:1.5;
    }

    footer{
      margin-top:28px;
      color: rgba(255,255,255,.75);
      font-size: 13px;
      text-align:center;
    }
    .smallLegal{
      display:inline-block;
      margin-top:6px;
      opacity:.85;
      font-size:12px;
    }

    /* added: forgot/reset UI (minimal, matches your look) */
    .forgotRow{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .tinyLink{
      font-size:13px;
      color:rgba(255,255,255,.85);
      text-decoration:underline;
      cursor:pointer;
      background:transparent;
      border:none;
      padding:0;
    }
    .resetBox{
      margin-top:12px;
      padding:12px 14px;
      border-radius:16px;
      background: rgba(0,0,0,.14);
      border:1px solid rgba(255,255,255,.16);
      display:none;
    }
    .resetBox .btnRow{margin-top:10px}

.support-image {
  width: 100%;
  margin-bottom: 16px;
}

.support-image img {
  width: 100%;
  max-height: 180px;
  object-fit: cover;
  border-radius: 16px;
  display: block;
}
  </style>
</head>

<body>
  <div class="wrap">

    <div class="nav">
      <a href="index.html" class="brand">
        <div class="brandLogo"><img src="logo.png" alt="OnlyPaws logo"></div>
        <span class="brandText">OnlyPaws</span>
      </a>
      <div class="pill">For Fans</div>
    </div>

    <div class="hero">
      <div class="panel">
        <div class="pill">Follow creators. Unlock premium.</div>
        <h1>Become a fan</h1>
        <p class="sub">
          Follow your favorite creators, see free posts, and unlock premium content with subscriptions or single purchases.
          Payments are handled securely through Stripe.
        </p>

        <div class="list">
          <div class="listItem">üÜì Follow creators for free</div>
          <div class="listItem">üëÄ See free posts instantly</div>
          <div class="listItem">üîì Unlock premium posts (subscription or single purchase)</div>
          <div class="listItem">üí≥ Secure payments via Stripe</div>
        </div>

        <div class="authBox">
          <form id="fan-auth-form">
            <input type="email" id="fan-email" placeholder="Email" required />
            <input type="password" id="fan-password" placeholder="Password (min 6)" required />

            <div class="btnRow">
              <button type="submit" class="btn" id="fanSignupBtn">Create fan account</button>
              <button type="button" class="ghost" id="fanLoginBtn">Log in</button>
            </div>

            <!-- added: forgot password link -->
            <div class="forgotRow">
              <button type="button" class="tinyLink" id="forgotBtn">Forgot password?</button>
              <span style="font-size:12px;color:rgba(255,255,255,.75);">
                You‚Äôll receive an email link
              </span>
            </div>

            <!-- added: inline reset box (optional but super useful) -->
            <div class="resetBox" id="resetBox">
              <div style="font-size:13px;color:rgba(255,255,255,.85);line-height:1.45;">
                Send a password reset email to the address above.
              </div>
              <div class="btnRow">
                <button type="button" class="btn" id="sendResetBtn">Send reset email</button>
                <button type="button" class="ghost" id="cancelResetBtn">Cancel</button>
              </div>
            </div>

            <div id="fanMsg" class="authMsg"></div>
          </form>
        </div>

        <div class="note">
          After signup/login you‚Äôll be redirected to your profile.
        </div>
      </div>
      <div class="panel">
        <div class="support-image">
          <img src="onlypaws-fans.png" alt="Support OnlyPaws">
        </div>
        <h2 style="margin:0 0 10px;">Support OnlyPaws üêæ</h2>
        <p class="sub" style="font-size:1rem;">
          Love OnlyPaws and want to support the project?
Support Us. 
This is a recurring support contribution billed every 3 months.
It does not unlock any features or memberships.

It simply helps us keep OnlyPaws alive, improve the platform,
and take care of our furry friends üíú
        </p>

        <a class="btn"
           href="https://buy.stripe.com/4gM14ocjm5qec9w04n5wI05"
           target="_blank"
           rel="noopener"
           style="margin-top:14px;">
          Support OnlyPaws üêæ
        </a>

        <div class="note">Cancel anytime ‚Ä¢ Secure payments via Stripe</div>

        <div class="btnRow" style="margin-top:16px;">
          <a class="ghost" href="faq-fans.html">Fan FAQ</a>
          <a class="ghost" href="creators.html">I‚Äôm a creator</a>
        </div>

        <div class="note">
          Need help? Email us at <b>onlypawssupp@gmail.com</b>.
        </div>
      </div>
    </div>

    <footer>
      ¬© 2026 OnlyPaws ‚Ä¢ Built with toe beans energy üêæ<br/>
      <span class="smallLegal">
        OnlyPaws is an independent digital platform. Features may evolve over time.
      </span>
      <br/><br/>
      <a href="content-policy.html" style="color:white;text-decoration:underline;">Content Policy</a>
      &nbsp;¬∑&nbsp;
      <a href="privacy-policy.html" style="color:white;text-decoration:underline;">Privacy Policy</a>
      &nbsp;¬∑&nbsp;
      <a href="terms.html" style="color:white;text-decoration:underline;">Terms of Service</a>
    </footer>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase.js"></script>

  <script>
    const form = document.getElementById("fan-auth-form");
    const msg = document.getElementById("fanMsg");
    const emailEl = document.getElementById("fan-email");
    const passEl  = document.getElementById("fan-password");
    const loginBtn = document.getElementById("fanLoginBtn");
    const signupBtn = document.getElementById("fanSignupBtn");

    const forgotBtn = document.getElementById("forgotBtn");
    const resetBox = document.getElementById("resetBox");
    const sendResetBtn = document.getElementById("sendResetBtn");
    const cancelResetBtn = document.getElementById("cancelResetBtn");

    function setMsg(t){ msg.textContent = t || ""; }

    function getNextPath(){
      const next = new URLSearchParams(window.location.search).get("next");
      if(!next) return "profile.html";
      if(next === "feed") return "feed.html";
      if(next === "profile") return "profile.html";
      if(next.endsWith(".html")) return next;
      return "profile.html";
    }

    function setBusy(b){
      signupBtn.disabled = b;
      loginBtn.disabled = b;
      emailEl.disabled = b;
      passEl.disabled = b;
      forgotBtn.disabled = b;
      sendResetBtn.disabled = b;
      cancelResetBtn.disabled = b;
    }

    function showResetBox(show){
      resetBox.style.display = show ? "block" : "none";
    }

    if (typeof onlypawsClient === "undefined") {
      setMsg("‚ùå onlypawsClient not found.\nCheck supabase.js path + script order.");
      console.error("onlypawsClient is undefined.");
    }

    
    async function bootstrapUser(role) {
      // crea/aggiorna profiles + wallets (idempotente)
      const { data: uData, error: uErr } = await onlypawsClient.auth.getUser();
      if (uErr) throw uErr;
      const user = uData?.user;
      if (!user) throw new Error("No user session");

      const uid = user.id;
      const now = new Date().toISOString();

      // profiles
      const pRes = await onlypawsClient
        .from("profiles")
        .upsert({ user_id: uid, role, updated_at: now }, { onConflict: "user_id" })
        .select()
        .maybeSingle();
      if (pRes.error) throw pRes.error;

      // wallets (PK = profile_id)
      const wRes = await onlypawsClient
        .from("wallets")
        .upsert({ profile_id: uid }, { onConflict: "profile_id" })
        .select()
        .maybeSingle();
      if (wRes.error) throw wRes.error;

      // NOTE: entitlements are paid memberships/plans. Do NOT auto-grant anything here.

      return { profile: pRes.data, wallet: wRes.data };
    }

async function redirectAfterAuth(){
      const next = getNextPath();
      window.location.href = next;
    }

    // ‚úÖ On page load: if session exists (persisted), bootstrap + redirect.
    (async () => {
      try {
        const { data: s } = await onlypawsClient.auth.getSession();
        if (s?.session) {
          await bootstrapUser('fan');
          redirectAfterAuth();
        }
      } catch (e) {
        console.warn("auto-redirect skipped:", e);
      }
    })();
// Forgot password (UI)
    forgotBtn.addEventListener("click", () => {
      // prefill: user can type email then click
      showResetBox(true);
      setMsg("");
    });

    cancelResetBtn.addEventListener("click", () => {
      showResetBox(false);
      setMsg("");
    });

    // Send reset email
    sendResetBtn.addEventListener("click", async () => {
      setBusy(true);
      try{
        const email = (emailEl.value || "").trim();
        if(!email){
          setMsg("Please enter your email first.");
          return;
        }

        // Where user will land after clicking email link
        // (you can change file name if yours is different)
        const redirectTo = window.location.origin + "/reset-password.html";

        setMsg("Sending reset email‚Ä¶");
        const { error } = await onlypawsClient.auth.resetPasswordForEmail(email, { redirectTo });

        if(error){
          setMsg("‚ùå " + error.message);
          return;
        }

        setMsg("‚úÖ Email sent! Check your inbox (and spam) üêæ");
        showResetBox(false);
      } finally {
        setBusy(false);
      }
    });

    // SIGN UP
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      setMsg("Creating your fan account‚Ä¶");
      setBusy(true);

      try{
        const email = (emailEl.value || "").trim();
        const password = passEl.value || "";

        if(!email){ setMsg("Please enter your email."); return; }
        if(password.length < 6){ setMsg("Password must be at least 6 characters."); return; }

        const { data, error } = await onlypawsClient.auth.signUp({
          email,
          password,
          options: {
            data: { role: "fan" },
            emailRedirectTo: window.location.origin + "/" + getNextPath()
          }
        });

        if(error){
          setMsg("‚ùå " + error.message);
          return;
        }

        if(data?.session){
          await bootstrapUser('fan');
          await redirectAfterAuth();
          return;
        }

        setMsg("‚úÖ Account created. Check your email to confirm üêæ");
      } finally {
        setBusy(false);
      }
    });

    // LOG IN
    loginBtn.addEventListener("click", async () => {
      setMsg("Logging in‚Ä¶");
      setBusy(true);

      try{
        const email = (emailEl.value || "").trim();
        const password = passEl.value || "";

        if(!email){ setMsg("Please enter your email."); return; }
        if(!password){ setMsg("Please enter your password."); return; }

        const { data, error } = await onlypawsClient.auth.signInWithPassword({ email, password });

        if(error){
          setMsg("‚ùå " + error.message);
          return;
        }

        if(data?.session){
          await bootstrapUser('fan');
          await redirectAfterAuth();
          return;
        }

        setMsg("Logged in. Redirecting‚Ä¶");
        await redirectAfterAuth();
      } finally {
        setBusy(false);
      }
    });
  </script>
</body>
</html>